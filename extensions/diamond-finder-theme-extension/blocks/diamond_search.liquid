<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.css" />
{{ 'tailwind-output.css' | asset_url | stylesheet_tag }}
{{ 'diamond-filters.css' | asset_url | stylesheet_tag }}

<div class="tw-p-4 md:tw-p-8">
  <div class="diamond-filters-ui tw-mb-8 tw-p-6 tw-bg-gray-50 tw-rounded-lg tw-shadow">
    <!-- Top Row: Natural/Lab Grown Tabs -->
    <div class="tw-flex tw-justify-center tw-mb-6">
      <div class="tw-flex tw-gap-2 tw-w-64" data-filter-group="ds-type" data-multiselect="false">
        <button
          type="button"
          class="tw-w-full tw-px-3 tw-py-1.5 md:tw-px-4 md:tw-py-2 tw-border tw-border-gray-300 tw-rounded-md tw-text-sm tw-font-medium hover:tw-bg-gray-100 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-offset-1 focus:tw-ring-gray-500 data-[active='true']:tw-bg-gray-700 data-[active='true']:tw-text-white data-[active='true']:tw-border-gray-700 transition-colors duration-150 ease-in-out"
          data-value="Natural"
          aria-pressed="false"
          id="ds-type-natural"
        >
          Natural
        </button>
        <button
          type="button"
          class="tw-w-full tw-px-3 tw-py-1.5 md:tw-px-4 md:tw-py-2 tw-border tw-border-gray-300 tw-rounded-md tw-text-sm tw-font-medium hover:tw-bg-gray-100 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-offset-1 focus:tw-ring-gray-500 data-[active='true']:tw-bg-gray-700 data-[active='true']:tw-text-white data-[active='true']:tw-border-gray-700 transition-colors duration-150 ease-in-out"
          data-value="Lab Grown"
          aria-pressed="false"
          id="ds-type-lab-grown"
        >
          Lab Grown
        </button>
      </div>
    </div>

    <!-- Main Filter Grid -->
    <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-x-10 tw-gap-y-8 tw-pb-8">
      <!-- Shape Filter -->
      <div>
        <label class="tw-block tw-text-base tw-font-medium tw-text-gray-700 tw-mb-2">Shape <span class="tw-ml-1 tw-text-gray-400">ⓘ</span></label>
        {% render 'filter-button-group', group_id: 'ds-shape', options_str: "Round:ROUND|Princess:PRINCESS|Cushion:CUSHION|Emerald:EMERALD|Oval:OVAL|Radiant:RADIANT|Asscher:ASSCHER|Marquise:MARQUISE|Heart:HEART|Pear:PEAR", multiselect: "false", custom_class: "shape-buttons tw-grid tw-grid-cols-5 tw-gap-2" %}
      </div>

      <!-- Price Filter -->
      <div>
        <label class="tw-block tw-text-base tw-font-medium tw-text-gray-700 tw-mb-2">Price</label>
        <div class="tw-grid tw-grid-cols-2 tw-gap-x-2 tw-mb-2">
          <div>
            <label for="ds-min-price" class="tw-block tw-text-xs tw-font-medium tw-text-gray-500 tw-mb-1">Min Price</label>
            <input type="text" id="ds-min-price" placeholder="$200" class="tw-w-full focus:tw-ring-gray-500 focus:tw-border-gray-500 tw-block tw-shadow-sm tw-text-base tw-border-gray-300 tw-rounded-md tw-p-2">
          </div>
          <div>
            <label for="ds-max-price" class="tw-block tw-text-xs tw-font-medium tw-text-gray-500 tw-mb-1">Max Price</label>
            <input type="text" id="ds-max-price" placeholder="$5,000,000" class="tw-w-full focus:tw-ring-gray-500 focus:tw-border-gray-500 tw-block tw-shadow-sm tw-text-base tw-border-gray-300 tw-rounded-md tw-p-2">
          </div>
        </div>
        <div id="ds-price-slider" class="tw-mt-8"></div>
      </div>

      <!-- Carat Filter -->
      <div>
        <label class="tw-block tw-text-base tw-font-medium tw-text-gray-700 tw-mb-2">Carat <span class="tw-ml-1 tw-text-gray-400">ⓘ</span></label>
        <div class="tw-grid tw-grid-cols-2 tw-gap-x-2 tw-mb-2">
          <div>
            <label for="ds-min-carat" class="tw-block tw-text-xs tw-font-medium tw-text-gray-500 tw-mb-1">Min Carat</label>
            <input type="number" id="ds-min-carat" step="0.01" placeholder="1.00" class="tw-w-full focus:tw-ring-gray-500 focus:tw-border-gray-500 tw-block tw-shadow-sm tw-text-base tw-border-gray-300 tw-rounded-md tw-p-2">
          </div>
          <div>
            <label for="ds-max-carat" class="tw-block tw-text-xs tw-font-medium tw-text-gray-500 tw-mb-1">Max Carat</label>
            <input type="number" id="ds-max-carat" step="0.01" placeholder="8.00" class="tw-w-full focus:tw-ring-gray-500 focus:tw-border-gray-500 tw-block tw-shadow-sm tw-text-base tw-border-gray-300 tw-rounded-md tw-p-2">
          </div>
        </div>
        <div id="ds-carat-slider" class="tw-mt-8"></div>
      </div>

      <!-- Colour Filter -->
      <div>
        <label for="ds-colour-slider" class="tw-block tw-text-base tw-font-medium tw-text-gray-700 tw-mb-2">Colour <span class="tw-ml-1 tw-text-gray-400">ⓘ</span></label>
        <div class="tw-relative">
          <div id="ds-colour-images" class="tw-absolute tw-bottom-full tw-left-0 tw-right-0 tw-flex tw-justify-between tw-items-end tw-bg-white tw-opacity-0 tw-pointer-events-none tw-transition-opacity tw-duration-300">
            {% assign color_grades_for_images = "L,K,J,I,H,G,F,E,D" | split: ',' %}
            {% for grade_img_filename in color_grades_for_images %}
              <div class="tw-w-1/9 tw-text-center">
                <img src="{{ '/' | append: grade_img_filename | append: '.jpg' | asset_url }}" alt="{{ grade_img_filename }} color" class="tw-mx-auto tw-h-10 tw-w-auto" width="40" height="40">
              </div>
            {% endfor %}
          </div>

          {% comment %} <input type="range" id="ds-colour-slider" name="ds-colour-slider" min="0" max="8" value="4" class="tw-w-full"> {% endcomment %}
          <div id="ds-colour-slider-noui" class="tw-mt-8"></div>

          <div class="tw-flex tw-mt-4 tw-text-sm tw-text-gray-500" id="ds-colour-labels">
            {% assign color_grades_for_labels = "L,K,J,I,H,G,F,E,D" | split: ',' %}
            {% for grade_label in color_grades_for_labels %}
            <span class="tw-flex-1 tw-text-center">{{ grade_label }}</span>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Clarity Filter -->
      <div>
        <label for="ds-clarity-slider" class="tw-block tw-text-base tw-font-medium tw-text-gray-700 tw-mb-2">Clarity <span class="tw-ml-1 tw-text-gray-400">ⓘ</span></label>

        <div id="ds-clarity-slider-noui" class="tw-mt-8"></div>
        <div class="tw-flex tw-justify-between tw-mt-4 tw-text-sm tw-text-gray-500" id="ds-clarity-labels">
          <span>SI2</span><span>SI1</span><span>VS2</span><span>VS1</span><span>VVS2</span><span>VVS1</span><span>IF</span><span>FL</span>
        </div>
      </div>

      <!-- Cut Filter -->
      <div>
        <label for="ds-cut-grade-slider" class="tw-block tw-text-base tw-font-medium tw-text-gray-700 tw-mb-2">Cut Grade <span class="tw-ml-1 tw-text-gray-400">ⓘ</span></label>

        <div id="ds-cut-grade-slider-noui" class="tw-mt-8"></div>
        <div class="tw-flex tw-justify-between tw-mt-4 tw-text-sm tw-text-gray-500" id="ds-cut-grade-labels">
          <span>Good</span><span>Very Good</span><span>Excellent</span><span>Astor</span>
        </div>
      </div>
    </div>

    {% comment %} <div class="tw-mt-6 tw-text-center">
      <button type="button" id="ds-advanced-filters-toggle" class="tw-text-base tw-text-gray-600 hover:tw-text-gray-800">
        Advanced Filters <span class="tw-inline-block tw-transform group-hover:tw-rotate-180 tw-transition-transform"></span>
      </button>
    </div>

    <div id="ds-advanced-filters-content" class="tw-hidden tw-mt-4 tw-border-t tw-pt-4">
      <p class="tw-text-gray-500">Advanced filter options will appear here.</p>
    </div> {% endcomment %}

    <div class="tw-flex tw-justify-end tw-mt-6 tw-hidden"> <!-- Hidden for now, as per image only advanced filters button is visible initially -->
      <button type="button" id="ds-apply-filters" class="tw-bg-blue-600 hover:tw-bg-blue-700 tw-text-white tw-font-semibold tw-py-2 tw-px-6 tw-rounded-md tw-shadow-md tw-transition-colors">Search Diamonds</button>
    </div>
  </div>

  <div class="tw-flex tw-justify-between tw-items-center tw-mb-4">
    <p class="tw-text-base tw-text-gray-700">Results - <span id="ds-results-count">0</span> Diamonds</p>
    <div class="tw-flex tw-items-center tw-space-x-2">
      <div class="tw-flex tw-border tw-border-gray-300 tw-rounded">
        <button id="ds-view-list" class="tw-p-2 tw-border-r tw-border-gray-300"><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="tw-w-5 tw-h-5"><path d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg></button>
        <button id="ds-view-grid" class="tw-p-2 tw-bg-gray-200"><svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="tw-w-5 tw-h-5"><path d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 14a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 14a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg></button>
      </div>
      <div>
        <label for="ds-sort-by" class="tw-sr-only">Sort by</label>
        <select id="ds-sort-by" name="ds-sort-by" class="tw-block tw-w-full tw-pl-3 tw-pr-10 tw-py-2 tw-text-base tw-border-gray-300 focus:tw-outline-none focus:tw-ring-gray-500 focus:tw-border-gray-500 tw-rounded-md">
          <option>Price: low to high</option>
          <option>Price: high to low</option>
          <option>Carat: low to high</option>
          <option>Carat: high to low</option>
        </select>
      </div>
    </div>
  </div>

  <div id="diamond-grid-area" class="tw-bg-white">
    <!-- JS will put initial loading message here -->
    <!-- Products will be dynamically inserted here by renderDiamonds -->
    <!-- The initial loading message from the original HTML structure will be handled by JS -->
  </div>

  <div id="ds-load-more-indicator" class="tw-text-center tw-py-6" style="display: none;">
    <p>Loading more diamonds...</p>
  </div>
</div>

<script src="{{ 'diamond-search.js' | asset_url }}" defer="defer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.js" defer></script>

{% schema %}
{
  "name": "Diamond Search",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Find Your Diamond"
    }
  ]
}
{% endschema %}